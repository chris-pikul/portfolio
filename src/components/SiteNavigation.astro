---
/**
 * Chris Pikul's Portfolio, designed and coded by Chris Pikul.
 * Copyright 2022 Chris Pikul. All Rights Reserved.
 * 
 * Provides the master navigation for the whole site, to be displayed
 * at the top of any page
 */
---
<>
  <nav id='master-nav-portrait' class='intro-second'>
    <ul class='nav-links'>
      <li class='nav-link'><a href='/' class='active'>About</a></li>
      <li class='nav-link'><a href='/projects'>Projects</a></li>
      <li class='nav-link'><a href='/articles'>Articles</a></li>
    </ul>
    <div class='dividers'>
      <div class='separator separator-round' />
      <div id='nav-portrait-active' class='separator' />
    </div>
  </nav>

  <nav id='master-nav-landscape' class='landscape intro-second'>
    <ul class='nav-links'>
      <li class='nav-link'><a href='/' class='active'>About</a></li>
      <li class='nav-link'><a href='/projects'>Projects</a></li>
      <li class='nav-link'><a href='/articles'>Articles</a></li>
    </ul>
    <div class='dividers'>
      <div class='separator separator-round' />
      <div id='nav-landscape-active' class='separator' />
    </div>
  </nav>
</>

<script>
  function hookPortrait() {
    console.info('Hooking up master navigation bar');

    const masterNav = document.getElementById('master-nav');
    if(!masterNav)
      return console.error(`No master navigation element present`);

    const activeSlider = document.getElementById('master-nav-active');
    if(!activeSlider)
      return console.error(`No navigation active slider available`);
    activeSlider.style.display = 'block';

    let activeLink:HTMLAnchorElement;

    const moveTo = (target?:HTMLElement) => {
      if(target) {
        console.info('Moving active slider to link target', target);
        const rect = target.getBoundingClientRect();
        
        activeSlider.setAttribute('style', `opacity: 1;`);
      } else if(activeLink) {
        // Return to active
        moveTo(activeLink);
      } else {
        // No active link
        activeSlider.style.opacity = '0';
      }
    };

    const makeActive = (link:HTMLAnchorElement) => {
      link.classList.add('active');
      activeLink = link;
      moveTo(link);
    };

    const hoverStart = (evt:MouseEvent) => {
      moveTo(evt.target as HTMLElement);
    };

    const hoverEnd = () => moveTo();

    const curPath = document.location.origin + document.location.pathname;
    console.info(`Current path = ${curPath}`);

    masterNav.querySelectorAll('a').forEach(link => {
      link.className = '';

      console.info(`Checking link path ${link.href}`);
      if(link.href === curPath) {
        console.info('Found active link');
        makeActive(link);
      }

      link.addEventListener('mouseenter', hoverStart);
      link.addEventListener('mouseleave', hoverEnd);
      link.addEventListener('click', hoverStart);
    });

    window.addEventListener('resize', () => moveTo(activeLink));
  }

  function hookLandscape() {

  }

  (() => {
    hookPortrait();
  })();
</script>

<style lang="scss" is:global>
  @use '../styles/_base' as *;
  @use '../styles/_colors' as *;

  #master-nav {
    position: sticky;

    padding: 1em 0.5em;
    color: $shade-300;
    color: var(--shade-300);

    #master-nav-links {
      display: flex;
      flex-flow: row nowrap;
      justify-content: space-between;
      align-items: flex-end;

      margin-bottom: 0.25em;
      padding: 0 0.5em;

      a, a:visited {
        box-sizing: content-box;
        padding: 0 0.5em;
        @include font-common();
        text-align: center;

        &:first-child { text-align: left; }
        &:last-child { text-align: right; }

        &:hover {
          color: $shade-400;
          color: var(--shade-400);
        }

        &:active {
          color: $shade-500;
          color: var(--shade-500);
        }

        &.active {
          color: $shade-600;
          color: var(--shade-600);
        }
      }
    }

    #master-nav-separators {
      position: relative;

      .separator {
        position: absolute;
        top: 0;
        left: 0;
      }

      #master-nav-active {
        display: none;

        left: 0.5em;
        width: 1em;
        height: 2px;

        color: $shade-400;
        color: var(--shade-400);
        opacity: 0;

        transform: translateX(-0.5em);
        transition: left ease-in 0.3s, width ease-out 0.3s, opacity ease 1s;

        &::before, &::after {
          top: -2px;
          width: 6px;
          height: 6px;
        }
      }
    }
  }

  @media screen and (min-device-width: 768px) and (orientation: landscape) {
    #master-nav {
      display: flex;
      flex-flow: row nowrap;

      position: absolute;
      top: 50%;
      left: 0;
      width: 2.25rem;
      height: 62vh;
      min-height: 375px;

      margin: 0 2rem 0 0;
      padding: 0;

      transform: translateY(-50%);

      #master-nav-links {
        display: flex;
        flex-flow: column nowrap;
        justify-content: space-between;
        align-items: center;

        width: 100%;
        height: 100%;

        margin: 0;
        padding: 1.5em 0;

        .nav-link {
          display: block;

          position: relative;
          width: 100%;
          height: 1px;

          &:first-child a {
            transform: rotate(270deg) translateX(-100%);
          }

          &:last-child a {
            transform: rotate(270deg) translateX(0);
          }
        }

        a, a:visited {
          display: block;
          box-sizing: border-box;

          position: absolute;
          top: 0;
          left: 0;

          transform-origin: 0 0;
          transform: rotate(270deg) translateX(-50%);
        }
      }

      #master-nav-separators {
        display: block;

        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 0.6rem;

        .separator {
          width: 2px;
          height: 100%;
          margin: 0 6px;

          &::before {
            top: 0;
            right: auto;
            bottom: auto;
            left: -3px;
          }

          &::after {
            top: auto;
            right: auto;
            bottom: 0;
            left: -3px;
          }
        }
      }
    }
  }
</style>