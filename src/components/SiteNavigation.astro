---
/**
 * Chris Pikul's Portfolio, designed and coded by Chris Pikul.
 * Copyright 2022 Chris Pikul. All Rights Reserved.
 * 
 * Provides the master navigation for the whole site, to be displayed
 * at the top of any page
 */
---
<nav id='master-nav'>
  <div id='master-nav-links'>
    <a href='/' class='active'>About</a>
    <a href='/projects'>Projects</a>
    <a href='/articles'>Articles</a>
  </div>
  <div id='master-nav-separators'>
    <div class='separator separator-round' />
    <div id='master-nav-active' class='separator' />
  </div>
</nav>

<script>
  (() => {
    console.info('Hooking up master navigation bar');

    const masterNav = document.getElementById('master-nav');
    if(!masterNav)
      return console.error(`No master navigation element present`);

    const activeSlider = document.getElementById('master-nav-active');
    if(!activeSlider)
      return console.error(`No navigation active slider available`);
    activeSlider.style.display = 'block';

    let activeLink:HTMLAnchorElement;

    const moveTo = (target?:HTMLElement) => {
      if(target) {
        console.info('Moving active slider to link target', target);
        const rect = target.getBoundingClientRect();
        
        activeSlider.style.opacity = '1';
        activeSlider.style.left = rect.x + 'px';
        activeSlider.style.width = (rect.width) + 'px';
      } else if(activeLink) {
        // Return to active
        moveTo(activeLink);
      } else {
        // No active link
        activeSlider.style.opacity = '0';
      }
    };

    const makeActive = (link:HTMLAnchorElement) => {
      link.classList.add('active');
      activeLink = link;
      moveTo(link);
    };

    const hoverStart = (evt:MouseEvent) => {
      moveTo(evt.target as HTMLElement);
    };

    const hoverEnd = () => moveTo();

    const curPath = document.location.origin + document.location.pathname;
    console.info(`Current path = ${curPath}`);

    masterNav.querySelectorAll('a').forEach(link => {
      link.className = '';

      console.info(`Checking link path ${link.href}`);
      if(link.href === curPath) {
        console.info('Found active link');
        makeActive(link);
      }

      link.addEventListener('mouseenter', hoverStart);
      link.addEventListener('mouseleave', hoverEnd);
      link.addEventListener('click', hoverStart);
    });

    window.addEventListener('resize', () => moveTo(activeLink));
  })();
</script>

<style lang="scss" is:global>
  @use '../styles/_base' as *;
  @use '../styles/_colors' as *;

  #master-nav {
    position: sticky;

    padding: 1em 0.5em;
    color: $shade-300;
    color: var(--shade-300);

    opacity: 0;
    animation: fadeNavIn 1.5s ease-in 1s forwards;

    @keyframes fadeNavIn {
      0% {
        opacity: 0;
      }
      100% {
        opacity: 1.0;
      }
    }

    #master-nav-links {
      display: flex;
      flex-flow: row nowrap;
      justify-content: space-between;
      align-items: flex-end;

      margin-bottom: 0.25em;
      padding: 0 0.5em;

      a, a:visited {
        box-sizing: content-box;
        padding: 0 0.5em;
        @include font-common();
        text-align: center;

        &:first-child { text-align: left; }
        &:last-child { text-align: right; }

        &:hover {
          color: $shade-400;
          color: var(--shade-400);
        }

        &:active {
          color: $shade-500;
          color: var(--shade-500);
        }

        &.active {
          color: $shade-600;
          color: var(--shade-600);
        }
      }
    }

    #master-nav-separators {
      position: relative;

      .separator {
        position: absolute;
        top: 0;
        left: 0;
      }

      #master-nav-active {
        display: none;

        left: 0.5em;
        width: 1em;
        height: 2px;

        color: $shade-400;
        color: var(--shade-400);
        opacity: 0;

        transform: translateX(-0.5em);
        transition: left ease-in 0.3s, width ease-out 0.3s, opacity ease 1s;

        &::before, &::after {
          top: -2px;
          width: 6px;
          height: 6px;
        }
      }
    }
  }
</style>